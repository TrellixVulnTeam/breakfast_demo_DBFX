{"ast":null,"code":"/*\nEXAMPLE: SearchL2 + ProvL1 + AskL1\n\nT> What did you have for breakfast this morning?\nS> I had a toast with butter and…\nCODE-SWITCHING BUTTON (L2 → L1)\nS> Mermelada (<trans: jam>)\nS> ¿Cómo se dice? (<trans: how do you say it?)\nCODE-SWITCHING BUTTON (L1 → L2)??\nT> Jam\nS> Jam\nT> Mhm\n\n\nT> What did you have for breakfast this morning?\nS> I had a toast with butter and…\nT> \n*/\nimport { send } from \"xstate\";\nconst sayColour = send(context => ({\n  type: \"SPEAK\",\n  value: `Repainting to ${context.recResult[0].utterance}`\n}));\n\nfunction say(text) {\n  return send(_context => ({\n    type: \"SPEAK\",\n    value: text\n  }));\n}\n\nconst esDict = {\n  'mermelada': 'jam',\n  'mantequilla': 'butter',\n  'tostada': 'toast'\n};\nexport const dmMachine = {\n  initial: 'idle',\n  states: {\n    idle: {\n      on: {\n        CLICK: 'init'\n      }\n    },\n    init: {\n      on: {\n        TTS_READY: 'welcome',\n        CLICK: 'welcome'\n      }\n    },\n    welcome: {\n      initial: 'prompt',\n      on: {\n        RECOGNISED: [{\n          target: 'helpWord',\n          cond: context => context.recResultL2[0].utterance.includes(\"cómo se dice\")\n        }, {\n          target: 'unrelated'\n        }],\n        TIMEOUT: '..'\n      },\n      states: {\n        prompt: {\n          entry: say(\"What did you have for breakfast this morning?\"),\n          on: {\n            ENDSPEECH: 'ask'\n          }\n        },\n        ask: {\n          entry: send('LISTEN')\n        }\n      }\n    },\n    helpWord: {\n      initial: 'prompt',\n      states: {\n        prompt: {\n          entry: send(context => ({\n            type: \"SPEAK\",\n            value: esDict[context.recResultL2[0].utterance.split(\" \")[context.recResultL2[0].utterance.split(\" \").length - 1].replace(/[?!]/, \"\")]\n          })),\n          on: {\n            ENDSPEECH: 'ask'\n          }\n        },\n        ask: {\n          entry: send('LISTEN'),\n          on: {\n            RECOGNISED: 'yes'\n          }\n        },\n        yes: {\n          entry: say(\"That's right!\"),\n          on: {\n            ENDSPEECH: 'ask'\n          }\n        }\n      }\n    },\n    unrelated: {\n      initial: 'prompt',\n      states: {\n        prompt: {\n          entry: say(\"Uh-huh\"),\n          on: {\n            ENDSPEECH: 'unrelated'\n          }\n        },\n        unrelated: {\n          always: '#root.dm.welcome'\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/home/andrea/Desktop/breakfast_demo/src/dmBreakfast.ts"],"names":["send","sayColour","context","type","value","recResult","utterance","say","text","_context","esDict","dmMachine","initial","states","idle","on","CLICK","init","TTS_READY","welcome","RECOGNISED","target","cond","recResultL2","includes","TIMEOUT","prompt","entry","ENDSPEECH","ask","helpWord","split","length","replace","yes","unrelated","always"],"mappings":"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","sourcesContent":["/*\nEXAMPLE: SearchL2 + ProvL1 + AskL1\n\nT> What did you have for breakfast this morning?\nS> I had a toast with butter and…\nCODE-SWITCHING BUTTON (L2 → L1)\nS> Mermelada (<trans: jam>)\nS> ¿Cómo se dice? (<trans: how do you say it?)\nCODE-SWITCHING BUTTON (L1 → L2)??\nT> Jam\nS> Jam\nT> Mhm\n\n\nT> What did you have for breakfast this morning?\nS> I had a toast with butter and…\nT> \n*/\n\n\nimport { MachineConfig, send, Action } from \"xstate\";\n\n\nconst sayColour: Action<SDSContext, SDSEvent> = send((context: SDSContext) => ({\n    type: \"SPEAK\", value: `Repainting to ${context.recResult[0].utterance}`\n}))\n\n\nfunction say(text: string): Action<SDSContext, SDSEvent> {\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\n}\n\n\nconst esDict: { [index: string]: string } = {\n    'mermelada': 'jam',\n    'mantequilla': 'butter',\n    'tostada': 'toast'\n}\n\n\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\n    initial: 'idle',\n    states: {\n        idle: {\n            on: {\n                CLICK: 'init'\n            }\n        },\n        init: {\n            on: {\n                TTS_READY: 'welcome',\n                CLICK: 'welcome'\n            }\n        },\n        welcome: {\n            initial: 'prompt',\n            on: {\n                RECOGNISED: [\n                    { target: 'helpWord', cond: (context) => context.recResultL2[0].utterance.includes(\"cómo se dice\") },\n                    { target: 'unrelated' }],\n                TIMEOUT: '..',\n            },\n            states: {\n                prompt: {\n                    entry: say(\"What did you have for breakfast this morning?\"),\n                    on: { ENDSPEECH: 'ask' }\n                },\n                ask: {\n                    entry: send('LISTEN')\n                }\n            }\n        },\n        helpWord: {\n            initial: 'prompt',\n            states: {\n                prompt: {\n                    entry: send((context: SDSContext) => ({\n                        type: \"SPEAK\",\n                        value: esDict[context.recResultL2[0].utterance.split(\" \")[context.recResultL2[0].utterance.split(\" \").length - 1].replace(/[?!]/, \"\")]\n                    })),\n                    on: { ENDSPEECH: 'ask' }\n                },\n                ask: {\n                    entry: send('LISTEN'),\n                    on: { RECOGNISED: 'yes' }\n                },\n                yes: {\n                    entry: say(\"That's right!\"),\n                    on: { ENDSPEECH: 'ask' }\n                },\n            }\n        },\n        unrelated: {\n            initial: 'prompt',\n            states: {\n                prompt: {\n                    entry: say(\"Uh-huh\"),\n                    on: { ENDSPEECH: 'unrelated' }\n                },\n                unrelated: {\n                    always: '#root.dm.welcome'\n                }\n            }\n        }\n    }\n})"]},"metadata":{},"sourceType":"module"}